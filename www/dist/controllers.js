function escapeEmailAddress(e){return!!e&&(e=e.toLowerCase(),e=e.replace(/\./g,","),e.trim())}angular.module("controllers",[]).controller("SignInCtrl",["$scope","$rootScope","$http","$state",function(e,t,o,n){e.sigin=function(){var e={mobile:this.user.phone,password:this.user.pwd};o({method:"post",url:t.baseuRL+"/api/auth/signin",headers:{"Content-Type":"application/json"},data:e}).then(function(e){n.go("menu.restaurant.overview")},function(e){})}}]).controller("SignUpCtrl",["$scope","$rootScope","$firebaseAuth","$window",function(e,t,o,n,a,i,r,l){e.user={email:"",password:""},e.createUser=function(){var e=this.user.email,o=this.user.password;if(!e||!o)return t.notify("Please enter valid credentials"),!1;t.show("Please wait.. Registering");var a="",i="";t.auth.$createUser(e,o,function(e,o){if(e)t.hide(),"INVALID_EMAIL"==e.code?t.notify("Invalid Email Address"):"EMAIL_TAKEN"==e.code?t.notify("Email Address already taken"):t.notify("Oops something went wrong. Please try again later");else{t.hide(),t.userEmail=o.email,n.location.href="#/menu/overview";var r=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));r.update({item7:a,item8:i},function(e){e?(t.hide(),t.notify("Oops! something went wrong. Try again later")):(t.hide(),t.notify("Successfully updated"))})}})}}]).controller("myListCtrl",["$rootScope","$scope","$window","$ionicModal","$firebase",function(e,t,o,n,a){e.show("Please wait... Processing"),t.list=[];var i=new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail));i.on("value",function(o){var n=o.val();t.list=[];for(var a in n)n.hasOwnProperty(a)&&0==n[a].isCompleted&&(n[a].key=a,t.list.push(n[a]));0==t.list.length?t.noData=!0:t.noData=!1,e.hide()}),n.fromTemplateUrl("templates/newItem.html",function(e){t.newTemplate=e}),t.newTask=function(){t.newTemplate.show()},t.markCompleted=function(t){e.show("Please wait... Updating List");var o=new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail)+"/"+t);o.update({isCompleted:!0},function(t){t?(e.hide(),e.notify("Oops! something went wrong. Try again later")):(e.hide(),e.notify("Successfully updated"))})},t.deleteItem=function(t){e.show("Please wait... Deleting from List");new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail));i.child(t).remove(function(t){t?(e.hide(),e.notify("Oops! something went wrong. Try again later")):(e.hide(),e.notify("Successfully deleted"))})}}]).controller("mapCtrl",["$scope","$ionicPopup","$ionicPlatform","$rootScope","$ionicLoading","$cordovaGeolocation",function(e,t,o,n,a,i){o.ready(function(){n.positions=[{lat:43.07493,lng:-89.381388}],e.$on("mapInitialized",function(t,o){e.map=o}),e.centerOnMe=function(){n.positions=[],a.show({template:"Loading..."});var o=function(t){var o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n.positions.push({lat:o.lat(),lng:o.lng()}),console.log(o),e.map.setCenter(o)},i=function(e){t.alert({title:"Turn on your gps",template:"Could not locate your device"})};navigator.geolocation.getCurrentPosition(o,i,{maximumAge:8e3,timeout:3e3,enableHighAccuracy:!0}),a.hide()}})}]).controller("newCtrl",["$rootScope","$scope","$window","$firebase",function(e,t,o,n){t.currentDate=new Date,t.minDate=new Date(2016,6,1),t.maxDate=new Date(2035,6,31),t.datePickerCallback=function(e){e?console.log("Selected date is : ",e):console.log("Date not selected")},t.data={item:""},t.close=function(){t.modal.hide()},t.createNew=function(){var o=this.data.item1,a=this.data.item2,i=this.data.item3,r=this.data.item4,l=e.positions[0].lat,s=e.positions[0].lng,c=this.data.item20;if(o||a||i||r){t.modal.hide(),e.show(),e.show("Please wait... Creating new");var u={item1:o,item2:a,item3:i,item4:r,item5:l,item6:s,item20:c,isCompleted:!1,created:Date.now(),updated:Date.now()},d=new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail));n(d).$add(u),e.hide()}}}]).controller("overviewCtrl",["$scope","$rootScope","$ionicModal","$location","$state","$http","$ionicPopup","$ionicLoading","$ionicPlatform","$timeout",function(e,t,o,n,a,i,r,l,s,c){s.ready(function(){l.show({template:'<ion-spinner class="ionicspinner spinner-dark" icon="android"></ion-spinner>'}),e.closedrestaurants=[],e.page=0,e.noMoreItemsAvailable=!1,e.loadMore=function(){e.page=e.page+1,s(),e.closedrestaurants.length>=40&&(e.noMoreItemsAvailable=!0),e.$broadcast("scroll.infiniteScrollComplete")};var s=function(o){e.lat=12.9106,e.lng=77.665;var n="/api/restaurants/list?lat="+e.lat+"&lng="+e.lng+"&carousel=true&page="+e.page;i({method:"get",url:t.baseuRL+n}).then(function(t){l.hide(),setTimeout(function(){},1e3),console.log(t),t.data.data.rest_list&&(angular.merge(e.closedrestaurants,t.data.data.rest_list[0].restaurants),e.carousels||(e.carousels=t.data.data.carousel),e.noMoreItemsAvailable=!0,console.log(e.closedrestaurants))},function(e){l.hide()})},u=function(e){l.hide(),r.alert({title:"Turn on your gps",template:"Could not locate your  device"})};navigator.geolocation.getCurrentPosition(s,u,{maximumAge:6e4,timeout:2e4,enableHighAccuracy:!0}),e.restaurantsort=function(){o.fromTemplateUrl("templates/newPass1.html",function(t){e.newTemplate=t,e.newTemplate.show()})},e.searchRD=function(){""===e.searchString?navigator.geolocation.getCurrentPosition(s,u,{maximumAge:6e4,timeout:2e4,enableHighAccuracy:!0}):i({method:"get",url:t.baseuRL+"/api/restaurants/search?str="+e.searchString+"&lat="+e.lat+"&lng="+e.lng+"&page="}).then(function(t){l.hide(),setTimeout(function(){},1e3),console.log(t),c(function(){e.searchquery=t.data.data},100)})},e.dishclick=function(o){i({method:"get",url:t.baseuRL+"/api/restaurants/search?str="+o+"&lat="+e.lat+"&lng="+e.lng+"&page="}).then(function(t){l.hide(),setTimeout(function(){},1e3),console.log(t),c(function(){e.searchquery=t.data.data,e.closedrestaurants=t.data.data.restaurants[0].restaurants},100)})},e.Locationedit=function(){a.go("menu.restaurant.notification")},e.restaurantclick=function(e){t.slug=e.slugs.restaurant,a.go("menu.restaurant.card")},e.sidemenu=function(e){n.path(e)}})}]).controller("MyCtrl",["$scope","$ionicGesture","$window","$interval",function(e,t,o,n){e.lastEventCalled="Try to Drag the content up, down, left or rigth";var a=angular.element(document.querySelector("#eventPlaceholder")),i=[{event:"dragup",text:"You dragged me UP!"},{event:"dragdown",text:"You dragged me Down!"},{event:"dragleft",text:"You dragged me Left!"},{event:"dragright",text:"You dragged me Right!"}];angular.forEach(i,function(o){t.on(o.event,function(t){e.$apply(function(){e.lastEventCalled=o.text})},a)})}]).controller("transactionCtrl",["$scope","$ionicModal","$ionicLoading","$ionicPopup","$rootScope","$cordovaCamera","$ionicPlatform","$firebase",function(e,t,o,n,a,i,r,l){r.ready(function(){t.fromTemplateUrl("templates/newItem.html",function(t){e.newTemplate=t}),e.transaction=function(){e.newTemplate.show()},a.positions=[],o.show({template:"Loading..."});var r=function(t){var o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);a.positions.push({lat:o.lat(),lng:o.lng()}),console.log(o),e.map.setCenter(o)},l=function(e){n.alert({title:"Turn on your gps",template:"Could not locate your 1 device"})};navigator.geolocation.getCurrentPosition(r,l,{maximumAge:6e3,timeout:2e3,enableHighAccuracy:!0}),o.hide();var s=new Firebase(a.baseUrl+escapeEmailAddress(a.userEmail));s.on("value",function(t){e.list=[];var o=t.val();console.log(o),console.log(a.image),a.image=o.item17}),e.takePhoto=function(){var t={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};i.getPicture(t).then(function(t){e.imgURI="data:image/jpeg;base64,"+t},function(e){})},e.choosePhoto=function(){var e={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};i.getPicture(e).then(function(e){a.imgURI="data:image/jpeg;base64,"+e},function(e){});var t=a.imgURI,o=new Firebase(a.baseUrl+escapeEmailAddress(a.userEmail));o.update({item17:t},function(e){e?(a.hide(),a.notify("Oops! something went wrong. Try again later")):(a.hide(),a.notify("Successfully updated"))})}})}]).controller("accountCtrl",["$scope","$rootScope","$window","$state","$firebase","$ionicGesture","$interval","$ionicModal","$filter",function(e,t,o,n,a,i,r,l,s){t.search=function(){t.Card=this.g,console.log(t.Card)};var c={item20:"Credit",item21:"Debit",item22:"Wallet"};e.list1=c,e.numLimit=10,e.colors=["#F44336","#9C27B0","#673AB7","#3F51B5","#0097A7","#00796B","#689F38","#4CAF50","#FF5722","#FD4037","#455A64"],e.swiper={},e.onReadySwiper=function(e){e.on("slideChangeStart",function(){console.log("slide start")}),e.on("onSlideChangeEnd",function(){console.log("slide end")})},t.show("Please wait... Processing"),e.list=[];var u=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));u.on("value",function(o){e.list=[];var n=o.val();for(var a in n)n.hasOwnProperty(a)&&n[a].item5==t.positions[0].lat&&(n[a].key=a,e.list.push(n[a]));0==e.list.length?e.noData=!0:e.noData=!1,t.hide()}),e.deleteItem=function(e){t.show("Please wait... Deleting from List");new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));u.child(e).remove(function(e){e?(t.hide(),t.notify("Oops! something went wrong. Try again later")):(t.hide(),t.notify("Successfully deleted"))})},l.fromTemplateUrl("templates/transaction.html",function(t){e.newTemplate=t}),e.transaction=function(){e.newTemplate.show()},e.favourite=function(e){console.log(localStorage.star),"true"==localStorage.star?(localStorage.star="false",console.log("star")):(localStorage.star="true",console.log("star1")),this.mySwitch=localStorage.star,console.log(this.mySwitch)},this.mySwitch=localStorage.star,console.log(this.mySwitch),e.lastEventCalled="true";var d=angular.element(document.querySelector("#eventPlaceholder")),g=[{event:"dragup",text:"true"},{event:"dragdown",text:"You dragged me Down!"},{event:"dragleft",text:"You dragged me Left!"},{event:"dragright",text:"You dragged me Right!"}];angular.forEach(g,function(t){i.on(t.event,function(o){e.$apply(function(){e.lastEventCalled=t.text})},d)}),e.noData3=function(){return"true"==e.lastEventCalled?(e.noData3=!0,console.log("yes")):(e.noData3=!1,console.log("no")),e.noData3},e.noData3()}]).controller("AppCtrl",["$scope","$location","$window",function(e,t,o){e.sidemenu=function(e){t.path(e)}}]).controller("testCtrl",["$scope","$rootScope","$cordovaCamera","$ionicPlatform","$firebase",function(e,t,o,n,a){n.ready(function(){var n=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));n.on("value",function(o){e.list=[];var n=o.val();console.log(n),console.log(t.image),t.image=n.item17}),e.takePhoto=function(){var t={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};o.getPicture(t).then(function(t){e.imgURI="data:image/jpeg;base64,"+t},function(e){})},e.choosePhoto=function(){var e={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};o.getPicture(e).then(function(e){t.imgURI="data:image/jpeg;base64,"+e},function(e){});var n=t.imgURI,a=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));a.update({item17:n},function(e){e?(t.hide(),t.notify("Oops! something went wrong. Try again later")):(t.hide(),t.notify("Successfully updated"))})}});var i=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));i.on("value",function(o){e.list=[];var n=o.val();console.log(n),console.log(t.image),t.name=n.item14,t.Phonenumber=n.item15,t.Email=n.item16}),e.edit=function(){var e=this.name,o=this.Phonenumber,n=this.Email;t.show("Please wait... Updating List");var a=new Firebase(t.baseUrl+escapeEmailAddress(t.userEmail));a.update({item14:e,item15:o,item16:n},function(e){e?(t.hide(),t.notify("Oops! something went wrong. Try again later")):(t.hide(),t.notify("Successfully updated"))})}}]).controller("IntroCtrl",["$scope","$rootScope",function(e,t){e.slides={currentSlide:0},e.title='<i class="icon ion-android-home"></i>',e.slideChanged=function(o){e.slideIndex=o,2==o&&(t.$storage.seenIntro=!0)}}]).controller("patternCtrl",["$scope","LoginService","$ionicPopup","$state",function(e,t,o,n){e.log_pattern=t.getLoginPattern();var a=new PatternLock("#lockPattern",{onDraw:function(o){e.log_pattern?t.checkLoginPattern(o).success(function(e){a.reset()}).error(function(e){a.error(),$rootScope.show("Invalid Pattern")}):(t.setLoginPattern(o),a.reset(),e.$apply(function(){e.log_pattern=t.getLoginPattern()}),$rootScope.show("Succesfully Created"),n.go("menu.settings"))}}),i=new PatternLock("#lockPattern1",{onDraw:function(o){t.checkLoginPattern(o)&&(t.setLoginPattern(o),i.reset(),e.$apply(function(){e.log_pattern=t.getLoginPattern()}),n.go("menu.settings"))}});e.login=function(){t.loginUser(e.data.username,e.data.password).success(function(e){n.go("tab.dash")}).error(function(e){o.alert({title:"Login failed!",template:"Please check your credentials!"})})}}]).controller("alwaysCtrl",["$scope","$rootScope","$ionicUser","$ionicPush",function(e,t,o,n){e.identifyUser=function(){var t=o.get();t.user_id||(t.user_id=o.generateGUID()),o.identify(t).then(function(){e.identified=!0,console.log("Identified user "+t.name+"\n ID "+t.user_id)})},e.pushRegister=function(){console.log("Ionic Push: Registering user"),n.register({canShowAlert:!0,canSetBadge:!0,canPlaySound:!0,canRunActionsOnWake:!0,onNotification:function(e){return!0}})}}]).controller("MainCtrl",["$scope",function(e){e.confirmed="1",e.selectChange=function(){switch(e.confirmed){case"1":e.selected="1";break;case"2":e.selected="2"}},e.selectChange()}]).controller("newPassCtrl",["$rootScope","$scope","$window","$ionicModal",function(e,t,o,n){t.data={item7:""},t.noData=function(){var o=new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail));return o.on("value",function(o){var n=o.val();console.log(n),e.item11=n.item7,""==!n.item7?(t.noData3=!0,console.log("yes")):(t.noData3=!1,console.log("no"))}),!t.noData3},t.close=function(){t.modal.hide()},t.createNew=function(o){var n=this.data.item7,a=this.data.item9;if(console.log(n),console.log(a),console.log(e.item11),""!=!a||e.item11!==n)return t.modal.hide(),void e.notify("Invalid Pin. Try it again.");n=a,t.modal.hide(),e.show("Please wait... Updating List");var i=new Firebase(e.baseUrl+escapeEmailAddress(e.userEmail));i.update({item7:n},function(t){t?(e.hide(),e.notify("Oops! something went wrong. Try again later")):(e.hide(),e.notify("Successfully updated"))})}}]).controller("newPass1Ctrl",["$rootScope","$scope","$window","$ionicModal",function(e,t,o,n){t.sfclose=function(){t.modal.hide()}}]).controller("settingsCtrl",["$scope","$window","$ionicPopup","$rootScope","$ionicLoading","$ionicModal","$cordovaGeolocation",function(e,t,o,n,a,i,r){}]).controller("feedbackCtrl",["$scope",function(e){e.numberSelection=5}]).controller("scanCtrl",["$scope",function(e){e.modalClasses=["slide-in-up","slide-in-down","fade-in-scale","fade-in-right","fade-in-left","newspaper","jelly","road-runner","splat","spin","swoosh","fold-unfold"]}]).controller("notificationCtrl",["$scope","$state",function(e,t){e.locationback=function(){t.go("menu.overview")}}]).controller("cardCtrl",["$scope","$rootScope","$http","$ionicSlideBoxDelegate","$ionicModal","$ionicLoading","$ionicPlatform",function(e,t,o,n,a,i,r){r.ready(function(){i.show({template:'<ion-spinner class="ionicspinner spinner-dark" icon="android"></ion-spinner>'}),e.toggleGroup=function(t){e.isGroupShown(t)?e.shownGroup=null:e.shownGroup=t},e.isGroupShown=function(t){return e.shownGroup===t},e.cartItemobject={};var r=function(t){t.id||(t.id=t.menu_item_id);var o={menu_item_id:t.id,quantity:t.quantity,variants:[],addons:[]};return e.cartItemobject[t.id]=o,e.cartItemarray=$.map(e.cartItemobject,function(e,t){return[e]}),e.cartItemarray};e.cartUpdate=function(n){console.log(n);var a=r(n),i={cart:{restaurantId:e.restaurant.id,cartItems:a,curDelLoc:{lat:12.9044624,lng:77.66223830000001,address:"Haralur Rd, Bengaluru, Karnataka, India",id:"",deliveryLocation:"Eastwood Township, Harlur"}}};o({method:"post",url:t.baseuRL+"/api/cart/update",headers:{"Content-Type":"application/json"},data:i}).then(function(t){console.log(t),e.checkout=t.data.data},function(e){})},n.update();var l=t.slug;o({method:"get",url:t.baseuRL+"/api/restaurants/menu?slug="+l}).then(function(t){console.log(t),e.restaurant=t.data.data,e.foodmenu=t.data.data.categories,console.log(e.foodmenu),i.hide()},function(e){}),e.finalcart=function(){a.fromTemplateUrl("templates/newPass.html",function(t){e.newTemplate=t,e.newTemplate.show()},{scope:e,animation:"slide-in-up"})},e.Finalcheckout=function(){var e={order:{payment_cod_method:"Mobikwik",address_id:"1237634",order_comments:"",csrf_token:"34462345-f3d0-4810-b178-10cb26994c01a5bc62c7-8640-4262-a4f9-d92406e10fc4"}};console.log(e),o({method:"post",url:t.baseuRL+"/api/order/place",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e}).then(function(e){console.log(e)},function(e){})}})}]).controller("bluetoothCtrl",["$ionicPopup","$ionicModal","$rootScope","$ionicPlatform","$scope","$timeout",function(e,t,o,n,a,i){n.ready(function(){a.checkBT=function(){ble.isEnabled(function(){e.alert({title:"Your sync starts.",template:" When sync done notification will appear."})},function(){e.show({title:"Turn on bluetooth",template:"Bluetooth is not enabled. Click on settings to turn on and to start sync.",scope:a,buttons:[{text:"Cancel"},{text:"<b>Settings</b>",type:"button-positive",onTap:function(){ble.showBluetoothSettings()}}]})})},a.connectBT=function(){ble.startScan([],function(t){console.log(JSON.stringify(t)),console.log(t),a.scandevices=t.name,e.show({title:"Scan Devices",template:'Select The OneCard </br> <button ng-repeat="class in scandevices" class="button-clear item  button-full button-dark" ng-click="connectBT1()">{{ class }}</button>',scope:a,buttons:[{text:a.scandevices,type:"button-positive",onTap:function(){console.log("hello"),a.connectBT1(),a.connectBT2()}}]})},function(){console.log("Error")}),setTimeout(ble.stopScan,5e3,function(){console.log("Scan complete")},function(){console.log("stopScan failed")})},a.connectBT1=function(){ble.connect("D0:39:72:B7:80:4C",function(){console.log("Connected")},function(){console.log("Error in connecting")})},$(function(){a.box=$(".box");var e=$(".box button");e.on("click",function(){a.box.toggleClass("active"),a.box.hasClass("active")?console.log("yup"):ble.disconnect("D0:39:72:B7:80:4C",function(){console.log("Disconnected")},function(){console.log("Cannot disconnect")})})}),a.connectBT2=function(){a.list=[];var t=new Firebase(o.baseUrl+escapeEmailAddress(o.userEmail));t.on("value",function(e){a.list=[];var t=e.val();for(var n in t)t.hasOwnProperty(n)&&t[n].item5==o.positions[0].lat&&(t[n].key=n,a.list.push(t[n]));0==a.list.length?a.noData=!0:a.noData=!1,o.hide()}),console.log(a.list),console.log(a.list[0]);for(var n=0;n<a.list.length;n++){var i=0,r=[];r[i]=a.list[n],console.log(r[i].item56);var l,s=r[i].item56,c=0,u=new Uint8Array(s.length);for(l=0;l<s.length;l++)u[c]=s.charCodeAt(l),c++;ble.write("D0:39:72:B7:80:4C","FFF0","FFF2",u.buffer,function(){console.log("Success data")},function(){console.log("Error data")}),setTimeout(function(){},500),i++,console.log(u)}ble.disconnect("D0:39:72:B7:80:4C",function(){console.log("Disconnected")},function(){console.log("Cannot disconnect")}),setTimeout(function(){},2e3),a.box.toggleClass("active"),e.alert({template:"Sync done. Your OneCard is ready"});var d=new Date;console.log(d.toLocaleString());var g=d.toString();console.log(d.toString()),console.log(d),a.e="",a.g="";for(var p=0;p<10;p++)a.e+=g.charAt(p);for(var p=16;p<21;p++)a.g+=g.charAt(p);console.log(a.e),console.log(a.g),localStorage.e=a.e,localStorage.g=a.g,a.m=localStorage.e,a.n=localStorage.g},a.m=localStorage.e,a.n=localStorage.g,a.connectBT3=function(){ble.read("D0:39:72:B7:80:4C","FFF0","FFF1",function(e){console.log("Success read data"),console.log(e)},function(){console.log("Error read data")})}})}]).controller("scanCtrl",["$rootScope","$scope","$window",function(e,t,o){}]);